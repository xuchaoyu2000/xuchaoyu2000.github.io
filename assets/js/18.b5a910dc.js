(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{169:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"nginx使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx使用","aria-hidden":"true"}},[t._v("#")]),t._v(" Nginx使用")]),a("h3",{attrs:{id:"作者：blackxu"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作者：blackxu","aria-hidden":"true"}},[t._v("#")]),t._v(" 作者：BlackXu")]),a("h2",{attrs:{id:"作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用","aria-hidden":"true"}},[t._v("#")]),t._v(" 作用")]),a("ul",[a("li",[t._v("静态资源服务器")]),a("li",[t._v("动态匹配")]),a("li",[t._v("反向代理")]),a("li",[a("code",[t._v("Gzip")]),t._v("压缩")]),a("li",[t._v("负载均衡")])]),a("h2",{attrs:{id:"搭建静态站点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建静态站点","aria-hidden":"true"}},[t._v("#")]),t._v(" 搭建静态站点")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("# 虚拟主机server块\nserver "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    # 端口\n    listen   "),a("span",{attrs:{class:"token number"}},[t._v("8080")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 匹配请求中的host值\n    server_name  localhost"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    # 监听请求路径\n    location "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        # 查找目录\n        root "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("source"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        # 默认查找\n        index index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ul",[a("li",[a("code",[t._v("server")]),t._v(" 配置虚拟主机的相关参数，可以有多个")]),a("li",[a("code",[t._v("server_name")]),t._v(" 通过请求中的"),a("code",[t._v("host")]),t._v("值 找到对应的虚拟主机的配置")]),a("li",[a("code",[t._v("location")]),t._v(" 配置请求路由，处理相关页面情况")]),a("li",[a("code",[t._v("root")]),t._v(" 查找资源的路径")])]),a("h2",{attrs:{id:"动态匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态匹配","aria-hidden":"true"}},[t._v("#")]),t._v(" 动态匹配")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("location "),a("span",{attrs:{class:"token operator"}},[t._v("~")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" \\"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("js"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("css"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("jpg"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    add_header Cache"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control no"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("store"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ul",[a("li",[a("code",[t._v("~* \\.(js|css|png|jpg|gif)$")]),t._v(" 是匹配以相关文件类型然后单独处理。 "),a("code",[t._v("add_header")]),t._v(" 是给请求的响应加上一个头信息"),a("code",[t._v("Cache-Control:no-store")]),t._v("，告知浏览器禁用缓存，每次都从服务器获取。")])]),a("h3",{attrs:{id:"匹配规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配规则","aria-hidden":"true"}},[t._v("#")]),t._v(" 匹配规则")]),a("p",[t._v("通常的形式如下:")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("location "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration "),a("span",{attrs:{class:"token constant"}},[t._v("A")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration "),a("span",{attrs:{class:"token constant"}},[t._v("B")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("documents"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration "),a("span",{attrs:{class:"token constant"}},[t._v("C")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation "),a("span",{attrs:{class:"token operator"}},[t._v("^")]),a("span",{attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("images"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration "),a("span",{attrs:{class:"token constant"}},[t._v("D")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation "),a("span",{attrs:{class:"token operator"}},[t._v("~")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" \\"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gif"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("jpg"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("jpeg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" configuration "),a("span",{attrs:{class:"token constant"}},[t._v("E")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ul",[a("li",[a("code",[t._v("=")]),t._v(" 表示精确匹配。只有请求的"),a("code",[t._v("url")]),t._v("路径与后面的字符串完全相等时，才会命中（优先级最高）。")]),a("li",[a("code",[t._v("^~")]),t._v(" 表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找。")]),a("li",[a("code",[t._v("~")]),t._v("表示该规则是使用正则定义的，区分大小写。")]),a("li",[a("code",[t._v("~*")]),t._v(" 表示该规则是使用正则定义的，不区分大小写。")])]),a("h2",{attrs:{id:"反向代理解决跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理解决跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" 反向代理解决跨域")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("location "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n    # 请求host传给后端\n    proxy_set_header Host $http_host"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 请求ip 传给后端\n    proxy_set_header "),a("span",{attrs:{class:"token constant"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token constant"}},[t._v("IP")]),t._v(" $remote_addr"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 请求协议传给后端\n    proxy_set_header "),a("span",{attrs:{class:"token constant"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Scheme $scheme"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 路径重写\n    rewrite  "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("  "),a("span",{attrs:{class:"token keyword"}},[t._v("break")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 代理服务器\n    proxy_pass http"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("9000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ul",[a("li",[a("code",[t._v("拦截路径/api")]),t._v(", 可以通过正则匹配。")]),a("li",[a("code",[t._v("proxy_set_header")]),t._v(" 允许重新定义或添加字段传递给代理服务器的请求头。")]),a("li",[a("code",[t._v("$http_host、$remote_addr、$scheme")]),t._v(" 为Nginx内置变量。")]),a("li",[a("code",[t._v("rewrite")]),t._v(" 根据"),a("code",[t._v("rewrite")]),t._v("后的请求"),a("code",[t._v("URI")]),t._v("，将路径重写，如："),a("code",[t._v("接口路径为 /user")]),t._v(", 我们可以请求 "),a("code",[t._v("/api/user")]),t._v("。")]),a("li",[a("code",[t._v("break")]),t._v(" 继续本次请求后面的处理 ,停止匹配下面的"),a("code",[t._v("location")]),t._v("。需要注意的是与之类似的"),a("code",[t._v("last")]),t._v("执行过程则是停止当前这个请求，并根据"),a("code",[t._v("rewrite")]),t._v("匹配的规则重新发起一个请求，从上到下依次匹配"),a("code",[t._v("location")]),t._v("后面的规则。")]),a("li",[a("code",[t._v("proxy_pass")]),t._v(" 代理服务器。")])]),a("h2",{attrs:{id:"配置gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置gzip","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置Gzip")]),a("ul",[a("li",[t._v("查看浏览器支持情况，确定请求头中的"),a("code",[t._v("Accept-Encoding")]),t._v("字段有无"),a("code",[t._v("gzip")]),t._v("。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    # 开启gzip 压缩\n    gzip on"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 设置gzip所需的http协议最低版本 （"),a("span",{attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("1.0")]),t._v("）\n    gzip_http_version "),a("span",{attrs:{class:"token number"}},[t._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 设置压缩级别，压缩级别越高压缩时间越长  （"),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token number"}},[t._v("9")]),t._v("）\n    gzip_comp_level "),a("span",{attrs:{class:"token number"}},[t._v("4")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 设置压缩的最小字节数， 页面Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Length获取\n    gzip_min_length "),a("span",{attrs:{class:"token number"}},[t._v("1000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 设置压缩文件的类型  （text"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    gzip_types text"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("plain application"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript text"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("css"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("h2",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡","aria-hidden":"true"}},[t._v("#")]),t._v(" 负载均衡")]),a("ul",[a("li",[t._v("可优化资源利用率，最大化吞吐量，减少延迟，确保容错配置，将流量分配到多个后端服务器。")])]),a("h3",{attrs:{id:"功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能","aria-hidden":"true"}},[t._v("#")]),t._v(" 功能")]),a("ol",[a("li",[t._v("轮询（默认），请求过来后，"),a("code",[t._v("Nginx")]),t._v("随机分配流量到任一服务器。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[t._v("weight=number")]),t._v("设置服务器的权重，默认为1，权重大的会被优先分配。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),t._v(" weight"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),t._v(" weight"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[t._v("backup")]),t._v("标记为备份服务器。当主服务器不可用时，将传递与备份服务器的连接。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),t._v(" backup"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ol",{attrs:{start:"4"}},[a("li",[a("code",[t._v("ip_hash")]),t._v("保持会话，保证同一客户端始终访问一台服务器。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ip_hash"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),t._v(" backup"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ol",{attrs:{start:"5"}},[a("li",[a("code",[t._v("least_conn")]),t._v("优先分配最少连接数的服务器，避免服务器超载请求过多。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    least_conn"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("ul",[a("li",[t._v("当我们需要代理一个集群时候可以通过下面这种方式实现：")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("http "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    upstream backend "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("3001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen      "),a("span",{attrs:{class:"token number"}},[t._v("9000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name localhost"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        location "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_set_header Host $http_host"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header "),a("span",{attrs:{class:"token constant"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token constant"}},[t._v("IP")]),t._v(" $remote_addr"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header "),a("span",{attrs:{class:"token constant"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Scheme $scheme"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            \n            proxy_pass backend"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])}],!1,null,null,null);s.default=e.exports}}]);